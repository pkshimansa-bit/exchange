<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Exchange - SHA1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background-color: #0d1b2a; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .header { width: 100%; padding: 20px; display: flex; align-items: center; box-sizing: border-box; }
        .header i { font-size: 20px; color: #00ff88; cursor: pointer; margin-right: 15px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { padding: 10px 30px; border-radius: 20px; background: #2c3e50; cursor: pointer; font-weight: bold; }
        .tab.active { background: #00ff88; color: #0d1b2a; }
        .exchange-card { width: 90%; max-width: 400px; background: #1b263b; border-radius: 20px; padding: 25px; text-align: center; border: 1px solid #415a77; position: relative; }
        .vip-badge { background: #00ff88; color: #0d1b2a; padding: 5px 15px; border-radius: 10px; font-weight: bold; font-size: 12px; }
        .task-count { float: right; color: #00ff88; font-weight: bold; }
        .mining-icon { font-size: 60px; color: #00ff88; margin: 30px 0; }
        .status-text { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #00ff88; }
        .info-box { background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px; text-align: left; font-size: 14px; color: #aaa; margin-bottom: 30px; line-height: 1.6; }
        .btn-start { width: 100%; padding: 15px; border-radius: 10px; border: none; background: #2c3e50; color: #7f8c8d; font-size: 16px; font-weight: bold; cursor: not-allowed; transition: 0.3s; }
        .btn-active { background: #00ff88; color: #0d1b2a; cursor: pointer; }
        .rotate { animation: spin 2s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <i class="fas fa-chevron-left" onclick="window.history.back()"></i>
        <h2 style="font-size: 18px; margin: 0; color: #00ff88;">QUANTUM EXCHANGE</h2>
    </div>

    <div class="tabs">
        <div class="tab active">MINING</div>
        <div class="tab" onclick="location.href='history.html'">HISTORY</div>
    </div>

    <div class="exchange-card">
        <div>
            <span class="vip-badge" id="vipLevel">LOADING...</span>
            <span class="task-count" id="taskDisplay">0 / 0</span>
        </div>

        <div class="mining-icon" id="miningIcon"><i class="fas fa-cog"></i></div>
        <div class="status-text" id="statusLabel">READY</div>

        <div class="info-box">
            <b>Network Scanning...</b><br>
            Amount: <span id="lastAmount">--</span><br>
            Currency: <span id="lastCurrency">--</span><br>
            Timestamp: <span id="lastTime">--</span>
        </div>

        <button id="exchangeBtn" class="btn-start" onclick="startExchange()">START EXCHANGE NOW</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Config (ඔයාගේ එක මෙතනට පේස්ට් කරන්න)
        const firebaseConfig = {
          authDomain: "sha1-105ac.firebaseapp.com",
  databaseURL: "https://sha1-105ac-default-rtdb.firebaseio.com",
  projectId: "sha1-105ac",
  storageBucket: "sha1-105ac.firebasestorage.app",
  messagingSenderId: "1056846099713",
  appId: "1:1056846099713:web:c27970161f7a2493db1700",
  measurementId: "G-T1EK6X2N48"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const userPhone = localStorage.getItem('userPhone') || "0715307639"; //

        let currentTasks = 0, maxTasks = 0, profitPerTask = 0, userBalance = 0;

        function loadData() {
            const userRef = db.ref('users/' + userPhone);
            userRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    const today = new Date().toLocaleDateString('en-US'); //

                    // 1. රෑ 12:00 Reset Logic
                    if (data.LastDate !== today) {
                        userRef.update({ tasksDone: 0, todayProfit: 0, LastDate: today });
                        return;
                    }

                    // 2. VIP මට්ටම අනුව සැකසුම්
                    const vip = data.currentVIP || "intern";
                    userBalance = data.balance || 0;
                    currentTasks = data.tasksDone || 0;

                    if (vip === "intern") { maxTasks = 5; profitPerTask = 20; }
                    else if (vip === "level_1") { maxTasks = 5; profitPerTask = 45; }
                    else if (vip === "level_2") { maxTasks = 10; profitPerTask = 60; }
                    else if (vip === "level_3") { maxTasks = 15; profitPerTask = 118; }

                    document.getElementById("vipLevel").innerText = vip.toUpperCase();
                    document.getElementById("taskDisplay").innerText = `${currentTasks} / ${maxTasks}`;
                    
                    const btn = document.getElementById("exchangeBtn");
                    if (currentTasks < maxTasks) {
                        btn.classList.add("btn-active");
                        btn.disabled = false;
                        btn.innerText = "START EXCHANGE NOW";
                    } else {
                        btn.classList.remove("btn-active");
                        btn.disabled = true;
                        btn.innerText = "TASKS COMPLETED";
                    }
                }
            });
        }

        function startExchange() {
            const btn = document.getElementById("exchangeBtn");
            const icon = document.getElementById("miningIcon");
            btn.disabled = true;
            btn.classList.remove("btn-active");
            icon.classList.add("rotate");
            document.getElementById("statusLabel").innerText = "SCANNING...";

            // තත්පර 3ක Animation එකක්
            setTimeout(() => {
                const profit = profitPerTask;
                const now = new Date();
                const timeStr = now.toLocaleTimeString();

                // History දත්ත සකස් කිරීම
                const historyEntry = {
                    amount: (profit * 10),
                    profit: profit,
                    time: timeStr,
                    date: now.toLocaleDateString(),
                    type: "Mining"
                };

                // Database Update කිරීම
                const userRef = db.ref('users/' + userPhone);
                userRef.update({
                    balance: userBalance + profit,
                    tasksDone: currentTasks + 1,
                    todayProfit: (currentTasks + 1) * profit
                });

                userRef.child('history').push(historyEntry).then(() => {
                    document.getElementById("lastAmount").innerText = (profit * 10).toFixed(2);
                    document.getElementById("lastCurrency").innerText = "LKR";
                    document.getElementById("lastTime").innerText = timeStr;
                    document.getElementById("statusLabel").innerText = "SUCCESS!";
                    icon.classList.remove("rotate");
                    
                    setTimeout(() => { document.getElementById("statusLabel").innerText = "READY"; }, 2000);
                });
            }, 3000);
        }

        window.onload = loadData;
    </script>
</body>
</html>


